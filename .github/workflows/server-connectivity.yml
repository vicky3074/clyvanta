name: ğŸŒ Server Connectivity Test

on:
  workflow_dispatch:  # Manual trigger only
  
jobs:
  connectivity:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test Server Connectivity
      run: |
        echo "ğŸŒ Testing connectivity to server..."
        
        # Test ping (we know this fails)
        echo "ğŸ“¡ Ping test:"
        ping -c 3 ${{ secrets.DROPLET_IP }} || echo "âŒ Ping failed (expected if ICMP disabled)"
        
        # Test SSH port (more important)
        echo "ğŸ”‘ SSH port test:"
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 22; then
          echo "âœ… SSH port 22 is open"
        else
          echo "âŒ SSH port 22 is not accessible"
        fi
        
        # Test HTTP ports
        echo "ğŸŒ HTTP port tests:"
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 80; then
          echo "âœ… HTTP port 80 is open"
        else
          echo "âŒ HTTP port 80 is not accessible"
        fi
        
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 8080; then
          echo "âœ… HTTP port 8080 is open"
        else
          echo "âŒ HTTP port 8080 is not accessible"
        fi
        
        # Test from different GitHub runner locations
        echo "ğŸ“ Testing from GitHub runner:"
        echo "Runner public IP:"
        curl -s https://ipinfo.io/ip || echo "Could not get runner IP"
        
        echo "ğŸ” Traceroute to server:"
        traceroute -m 10 ${{ secrets.DROPLET_IP }} || echo "Traceroute failed"