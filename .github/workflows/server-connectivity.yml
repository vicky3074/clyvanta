name: 🌐 Server Connectivity Test

on:
  workflow_dispatch:  # Manual trigger only
  
jobs:
  connectivity:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test Server Connectivity
      run: |
        echo "🌐 Testing connectivity to server..."
        
        # Test ping (we know this fails)
        echo "📡 Ping test:"
        ping -c 3 ${{ secrets.DROPLET_IP }} || echo "❌ Ping failed (expected if ICMP disabled)"
        
        # Test SSH port (more important)
        echo "🔑 SSH port test:"
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 22; then
          echo "✅ SSH port 22 is open"
        else
          echo "❌ SSH port 22 is not accessible"
        fi
        
        # Test HTTP ports
        echo "🌐 HTTP port tests:"
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 80; then
          echo "✅ HTTP port 80 is open"
        else
          echo "❌ HTTP port 80 is not accessible"
        fi
        
        if timeout 10 nc -zv ${{ secrets.DROPLET_IP }} 8080; then
          echo "✅ HTTP port 8080 is open"
        else
          echo "❌ HTTP port 8080 is not accessible"
        fi
        
        # Test from different GitHub runner locations
        echo "📍 Testing from GitHub runner:"
        echo "Runner public IP:"
        curl -s https://ipinfo.io/ip || echo "Could not get runner IP"
        
        echo "🔍 Traceroute to server:"
        traceroute -m 10 ${{ secrets.DROPLET_IP }} || echo "Traceroute failed"