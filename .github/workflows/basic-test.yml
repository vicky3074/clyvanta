name: 🔧 Basic Test

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Check Secrets
      run: |
        echo "🔧 Testing basic setup..."
        
        # Check if secrets exist (without exposing them)
        if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
          echo "❌ SSH_PRIVATE_KEY secret is missing or empty"
          exit 1
        else
          echo "✅ SSH_PRIVATE_KEY secret exists"
        fi
        
        if [ -z "${{ secrets.DROPLET_IP }}" ]; then
          echo "❌ DROPLET_IP secret is missing or empty"
          exit 1
        else
          echo "✅ DROPLET_IP secret exists: ${{ secrets.DROPLET_IP }}"
        fi
        
        echo "🔧 Secrets check complete"
        
    - name: Test SSH Setup
      run: |
        echo "🔧 Testing SSH key setup..."
        
        # Test SSH key format
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/test_key
        chmod 600 ~/.ssh/test_key
        
        # Check key format
        if ssh-keygen -l -f ~/.ssh/test_key; then
          echo "✅ SSH key format is valid"
        else
          echo "❌ SSH key format is invalid"
          exit 1
        fi
        
        echo "🔧 SSH key test complete"
        
    - name: Test Network Connection  
      run: |
        echo "🔧 Testing network connection to server..."
        
        # Test basic connectivity
        if ping -c 3 ${{ secrets.DROPLET_IP }}; then
          echo "✅ Server is reachable"
        else
          echo "❌ Server is not reachable"
          exit 1
        fi
        
        echo "🔧 Network test complete"